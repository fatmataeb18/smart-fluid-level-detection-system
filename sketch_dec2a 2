// #define echoPin 11
// #define trigPin 10

// long duration ;
// int distance;

// void setup (){
//   pinMode (trigPin , OUTPUT);
//   pinMode (echoPin , INPUT);
//   Serial.begin(9600) ;
// }



// void loop (){
//   digitalWrite (trigPin , LOW);
//   delayMicroseconds (2);
  
//   digitalWrite (trigPin , HIGH);
//   delayMicroseconds (10);
//   digitalWrite (trigPin , LOW);

//   duration = pulseIn (echoPin ,HIGH);

//   distance = duration * 0.034 /2;
//   Serial.print("distance : ");
//   Serial.println(distance );
//   // Serial.println("cm : ");
  
//   delay(1000);
// }
#include <Wire.h>
#include <LiquidCrystal_I2C.h>

LiquidCrystal_I2C lcd(0x27, 16, 2);

#define TRIG 10
#define ECHO 11

// نقاط لاغرانج
float Xs[] = {23, 19, 15, 6.5 };
float Ys[] = {0, 1.2, 2.4, 4.8};
int degree = (sizeof(Xs) / sizeof(Xs[0])) - 1;

void setup() {
  Serial.begin(9600);

  lcd.init();
  lcd.backlight();

  pinMode(TRIG, OUTPUT);
  pinMode(ECHO, INPUT);

  lcd.setCursor(0, 0);
  lcd.print("Level:");
}

long getDistance() {
  digitalWrite(TRIG, LOW);
  delayMicroseconds(2);
  digitalWrite(TRIG, HIGH);
  delayMicroseconds(10);
  digitalWrite(TRIG, LOW);

  long duration = pulseIn(ECHO, HIGH);
  return duration * 0.0343 / 2;
}

// دالة لاغرانج
float lagrange_interpolation(float X) {
  float multiplication = 0.0;

  for (int i = 0; i <= degree; i++) {
    float L = 1.0;
    for (int j = 0; j <= degree; j++) {
      if (i != j) {
        L *= ((X - Xs[j]) / (Xs[i] - Xs[j]));
      }
    }
    multiplication += (Ys[i] * L);
  }

  return multiplication;
}

void loop() {
  long dist = getDistance();          // قراءة المسافة
  float level = lagrange_interpolation(dist);   // حساب القيمة باللاغرانج

  // عرض القيمة على الشاشة فقط
  lcd.setCursor(0, 1);
  lcd.print("                ");  // مسح السطر
  lcd.setCursor(0, 1);
  lcd.print(level);

  // للطباعة على السيريال (اختياري)
  Serial.print("Level = ");
  Serial.println(level);

  delay(300);
}